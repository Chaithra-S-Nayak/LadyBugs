# For reference: https://docs.devrev.ai/snap-ins/references/manifest.
# Refactor the code based on your business logic.

version: "2"
name: "Work Tracker"
description: "Logs a message when a work item is created"

# keyrings reference: https://docs.devrev.ai/snap-ins/references/keyrings.
keyrings:
  organization:
    - name: slack_api_token
      display_name: Slack API Token
      description: Token to authenticate with Slack API for organizational use.
      types:
        - secrets
    - name: llm_api_token
      display_name: LLM API Token
      description: Token to authenticate with the shared LLM model.
      types:
        - secrets
    - name: devrev_api_token
      display_name: DevRev API Token
      description: Token to authenticate with DevRev API for accessing opportunities, conversations, and tickets.
      types:
        - secrets


# This is the name displayed in DevRev where the Snap-In takes actions using the token of this service account.
service_account:
  display_name: DevRev Bot

# Add any external connection, reference: https://docs.devrev.ai/snap-ins/concepts#connection.

# Add organization level inputs, reference: https://docs.devrev.ai/snap-ins/references/inputs.
inputs:
  organization:
    - name: slack_api_token
      description: Token to authenticate with Slack API.
      field_type: text
      is_required: true
      default_value: ""
      ui:
        display_name: Slack API Token
    - name: default_slack_channel
      description: Default Slack channel to post summaries.
      field_type: text
      is_required: false
      default_value: "#general"
      ui:
        display_name: Default Slack Channel
  user:
    - name: timeframe
      description: Time frame for analysis in hours (e.g., last 24 hours).
      field_type: integer
      is_required: true
      default_value: 24
      ui:
        display_name: Time Frame (Hours)
    - name: slack_channel
      description: Slack channel where the summary will be posted.
      field_type: text
      is_required: false
      default_value: ""
      ui:
        display_name: Slack Channel

# Event source reference: https://docs.devrev.ai/snap-ins/references/event_sources#supported-event-source-types-and-their-event-types.
event_sources:
  organization:
    - name: devrev-event-source
      description: Event source listening on DevRev events.
      display_name: DevRev events listener
      type: devrev-webhook
      config:
        event_types:
          - work_created

# Functions reference: https://docs.devrev.ai/snap-ins/references/functions.
functions:
  - name: on_work_creation
    description: function to trigger on work creation

# Automations reference: https://docs.devrev.ai/snap-ins/concepts#automation.
automations:
  - name: handle-work-created-event
    source: devrev-event-source
    event_types:
      - work_created
    function: on_work_creation
